<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Showcase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #2d2d2d;
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: 600;
        }

        .subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .tree-container {
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .tree-item {
            display: block;
            padding: 4px 0;
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: background-color 0.15s ease;
        }

        .tree-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .tree-item-content {
            display: flex;
            align-items: center;
            padding-left: var(--indent, 0px);
        }

        .expand-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 6px;
            transition: transform 0.2s ease;
            color: #888;
            font-size: 12px;
        }

        .expand-icon.expanded {
            transform: rotate(90deg);
        }

        .expand-icon.no-children {
            visibility: hidden;
        }

        .item-icon {
            margin-right: 8px;
            font-size: 14px;
        }

        .item-name {
            color: #e0e0e0;
            font-weight: 400;
        }
        
        .item-name.folder {
            cursor: pointer;
            color: #4a90e2;
        }
        
        .item-name.folder:hover {
            color: #6ba3e8;
            text-decoration: underline;
        }

        .item-name.file {
            color: #b8b8b8;
            cursor: pointer;
        }

        .item-name.file:hover {
            color: #ffffff;
            text-decoration: underline;
        }

        .tree-children {
            display: none;
        }

        .tree-children.expanded {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #888;
            font-size: 14px;
        }

        .no-files {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }

        .instructions {
            margin-top: 30px;
            padding: 20px;
            background: #262626;
            border-radius: 6px;
            border-left: 3px solid #4a90e2;
        }

        .instructions h3 {
            color: #ffffff;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .instructions p, .instructions li {
            color: #ccc;
            font-size: 13px;
            line-height: 1.5;
        }

        .instructions code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            color: #4a90e2;
        }

        .instructions pre {
            background: #1a1a1a;
            padding: 12px;
            border-radius: 4px;
            margin-top: 10px;
            overflow-x: auto;
            font-size: 12px;
            color: #e0e0e0;
        }

        .instructions ol {
            padding-left: 20px;
        }

        .instructions li {
            margin: 6px 0;
        }

        #breadcrumb {
            padding: 8px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 15px !important;
        }

        #breadcrumb a {
            color: #4a90e2;
            text-decoration: none;
        }

        #breadcrumb a:hover {
            text-decoration: underline;
        }

        #breadcrumb .separator {
            margin: 0 8px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            
            .tree-container {
                font-size: 13px;
            }
            
            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HTML Showcase</h1>
        <p class="subtitle">Client Review Portal</p>

        <div id="loading" class="loading">
            üîç Discovering HTML files...
        </div>

        <div id="main-view" style="display: none;">
            <div id="breadcrumb" style="margin-bottom: 20px; color: #888; font-size: 12px;"></div>
            <div id="tree-container" class="tree-container"></div>
        </div>

        <div id="no-files" class="no-files" style="display: none;">
            <h3>No HTML files found</h3>
            <p>Add your HTML files to the project directory and redeploy to see them here.</p>
        </div>
    </div>

    <script>
        let globalData = null;
        let currentPath = [];

        async function discoverFiles() {
            // Check if we're running locally (file:// protocol)
            const isLocal = window.location.protocol === 'file:';
            
            if (!isLocal) {
                try {
                    const response = await fetch('/files.json');
                    if (response.ok) {
                        const data = await response.json();
                        if (data.nestedStructure) {
                            return data;
                        }
                    }
                } catch (e) {
                    console.log('files.json not found, no files to display');
                    return { files: [], nestedStructure: {} };
                }
            }
            
            // For local development, return empty structure
            return { files: [], nestedStructure: {} };
        }

        function createTreeItem(name, isFolder, filePath = null, level = 0, folderPath = []) {
            const item = document.createElement('div');
            item.className = 'tree-item';
            item.setAttribute('data-level', level);
            
            const indent = level * 20;
            
            item.innerHTML = `
                <div class="tree-item-content" style="--indent: ${indent}px">
                    <span class="expand-icon ${isFolder ? '' : 'no-children'}">‚ñ∂</span>
                    <span class="item-icon">${isFolder ? 'üìÅ' : 'üìÑ'}</span>
                    <span class="item-name ${isFolder ? 'folder' : 'file'}">${name}</span>
                </div>
            `;
            
            if (isFolder) {
                const childrenContainer = document.createElement('div');
                childrenContainer.className = 'tree-children';
                item.appendChild(childrenContainer);
                
                const expandIcon = item.querySelector('.expand-icon');
                const folderName = item.querySelector('.item-name');
                
                // Separate handlers for expand arrow and folder name
                expandIcon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFolder(item);
                });
                
                folderName.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const newPath = [...folderPath, name];
                    navigateToFolder(newPath);
                });
            } else {
                // Add click handler for files
                const fileName = item.querySelector('.item-name');
                fileName.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (filePath) {
                        const encodedPath = encodeURI(filePath);
                        window.open(`/${encodedPath}`, '_blank');
                    }
                });
            }
            
            return item;
        }

        function toggleFolder(folderItem) {
            const expandIcon = folderItem.querySelector('.expand-icon');
            const childrenContainer = folderItem.querySelector('.tree-children');
            
            if (!childrenContainer) return;
            
            const isExpanded = childrenContainer.classList.contains('expanded');
            
            if (isExpanded) {
                childrenContainer.classList.remove('expanded');
                expandIcon.classList.remove('expanded');
                expandIcon.textContent = '‚ñ∂';
            } else {
                childrenContainer.classList.add('expanded');
                expandIcon.classList.add('expanded');
                expandIcon.textContent = '‚ñº';
            }
        }

        function buildTree(structure, container, level = 0, folderPath = []) {
            if (level > 5) return; // Max 5 levels as requested
            
            const sortedKeys = Object.keys(structure).sort((a, b) => {
                if (a === '_files') return 1;
                if (b === '_files') return -1;
                return a.localeCompare(b);
            });
            
            sortedKeys.forEach(key => {
                const item = structure[key];
                
                if (key === '_files' && Array.isArray(item)) {
                    // Add files
                    item.sort().forEach(filePath => {
                        const fileName = filePath.split('/').pop().replace(/\.html$/, '');
                        const fileItem = createTreeItem(fileName, false, filePath, level, folderPath);
                        container.appendChild(fileItem);
                    });
                } else if (typeof item === 'object' && key !== '_files') {
                    // Add folders
                    const folderItem = createTreeItem(key, true, null, level, folderPath);
                    container.appendChild(folderItem);
                    
                    const childrenContainer = folderItem.querySelector('.tree-children');
                    buildTree(item, childrenContainer, level + 1, [...folderPath, key]);
                }
            });
        }

        function getCurrentStructure(path) {
            let current = globalData.nestedStructure;
            for (const segment of path) {
                if (current[segment]) {
                    current = current[segment];
                } else {
                    return null;
                }
            }
            return current;
        }

        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('breadcrumb');
            const parts = ['Home'];
            
            if (path.length > 0) {
                parts.push(...path);
            }
            
            const breadcrumbHtml = parts.map((part, index) => {
                if (index === parts.length - 1) {
                    // Current page - not a link
                    return part;
                } else if (index === 0) {
                    // Home link
                    return `<a href="#" onclick="navigateToFolder([])">${part}</a>`;
                } else {
                    // Folder links
                    const folderPath = path.slice(0, index);
                    return `<a href="#${folderPath.join('/')}" onclick="navigateToFolder(${JSON.stringify(folderPath).replace(/"/g, '&quot;')})">${part}</a>`;
                }
            }).join('<span class="separator">‚Ä∫</span>');
            
            breadcrumb.innerHTML = breadcrumbHtml;
        }

        function navigateToFolder(path) {
            currentPath = path;
            
            // Update URL hash
            if (path.length > 0) {
                window.location.hash = path.map(segment => encodeURIComponent(segment)).join('/');
            } else {
                window.location.hash = '';
            }
            
            updateBreadcrumb(path);
            
            const treeContainer = document.getElementById('tree-container');
            treeContainer.innerHTML = '';
            
            const currentStructure = getCurrentStructure(path);
            if (currentStructure) {
                buildTree(currentStructure, treeContainer, 0, path);
                
                // Auto-expand first level if there are only a few items
                setTimeout(() => {
                    const topLevelFolders = treeContainer.querySelectorAll('[data-level="0"].tree-item');
                    if (topLevelFolders.length <= 3) {
                        topLevelFolders.forEach(folder => {
                            if (folder.querySelector('.tree-children')) {
                                toggleFolder(folder);
                            }
                        });
                    }
                }, 100);
            }
        }

        function parseHashPath() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                return hash.split('/').filter(segment => segment.length > 0).map(segment => decodeURIComponent(segment));
            }
            return [];
        }

        async function loadFiles() {
            const loading = document.getElementById('loading');
            const mainView = document.getElementById('main-view');
            const noFiles = document.getElementById('no-files');

            try {
                const data = await discoverFiles();
                globalData = data;
                const totalFiles = data.files ? data.files.length : 0;
                
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (totalFiles === 0) {
                        noFiles.style.display = 'block';
                        return;
                    }

                    mainView.style.display = 'block';
                    
                    if (data.nestedStructure && Object.keys(data.nestedStructure).length > 0) {
                        // Check if there's a hash path to navigate to
                        const hashPath = parseHashPath();
                        navigateToFolder(hashPath);
                    }
                }, 800);
                
            } catch (error) {
                console.error('Error loading files:', error);
                loading.innerHTML = '<div style="color: #ff6b6b;">Error loading files</div>';
            }
        }

        // Handle browser back/forward
        window.addEventListener('hashchange', () => {
            if (globalData) {
                const hashPath = parseHashPath();
                navigateToFolder(hashPath);
            }
        });

        // Load files when page loads
        document.addEventListener('DOMContentLoaded', loadFiles);
    </script>
</body>
</html>