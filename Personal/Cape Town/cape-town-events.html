<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cape Town Events Calendar</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#FAF8F5;--card:#FFFFFF;--border:#E8E3DC;--text:#2C2620;--mid:#6B6058;--light:#9B9088;--radius:10px}
body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;-webkit-font-smoothing:antialiased}

/* HEADER */
.header{background:linear-gradient(135deg,#1B3A4B 0%,#2C5F7C 60%,#3A7CA5 100%);color:#fff;padding:1.4rem 1.25rem 1rem;position:sticky;top:0;z-index:100;box-shadow:0 4px 20px rgba(27,58,75,0.3)}
.header h1{font-family:'Fraunces',serif;font-size:1.3rem;font-weight:600;letter-spacing:-0.02em}
.header .sub{font-size:0.7rem;opacity:0.5;margin-bottom:0.4rem}
.header-row{display:flex;gap:0.5rem;align-items:center;margin-top:0.4rem}
.month-nav{display:flex;align-items:center;gap:0.2rem}
.month-btn{background:rgba(255,255,255,0.15);border:none;border-radius:6px;color:#fff;padding:0.28rem 0.5rem;cursor:pointer;font-size:0.78rem;font-weight:700;transition:background 0.15s}
.month-btn:hover{background:rgba(255,255,255,0.3)}
.month-btn:disabled{opacity:0.25;cursor:default}
.month-label{font-size:0.85rem;font-weight:700;min-width:115px;text-align:center}
.ev-counter{margin-left:auto;font-size:0.65rem;font-weight:600;background:rgba(255,255,255,0.15);padding:0.15rem 0.45rem;border-radius:12px}

/* FILTER PANEL */
.filter-panel{background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:82px;z-index:90;padding:0.4rem 0.75rem 0.45rem}
.filter-section{display:flex;gap:0.25rem;align-items:center;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;margin-bottom:0.3rem}
.filter-section::-webkit-scrollbar{display:none}
.filter-section:last-child{margin-bottom:0}
.filter-label{font-size:0.58rem;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--light);flex-shrink:0;margin-right:0.15rem;min-width:32px}

.ftag{display:flex;align-items:center;gap:0.22rem;padding:0.18rem 0.45rem;border-radius:14px;border:1.5px solid var(--border);background:var(--card);font-size:0.62rem;font-weight:600;white-space:nowrap;cursor:pointer;user-select:none;transition:all 0.12s;color:var(--mid)}
.ftag .dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;transition:opacity 0.1s}
.ftag.off{opacity:0.3}

.select-btns{display:flex;gap:0.2rem;flex-shrink:0;margin-left:0.15rem}
.sel-btn{padding:0.15rem 0.4rem;border-radius:10px;border:1px solid var(--border);background:var(--bg);font-size:0.55rem;font-weight:700;color:var(--mid);cursor:pointer;white-space:nowrap;transition:all 0.1s}
.sel-btn:hover{background:var(--border)}

/* MAIN */
main{max-width:760px;margin:0 auto;padding:0.4rem 0.75rem 4rem}

/* DATE GROUPS */
.date-group{margin-bottom:0.6rem}
.date-header{display:flex;align-items:baseline;gap:0.5rem;padding:0.35rem 0 0.2rem;border-bottom:2px solid var(--text);margin-bottom:0.25rem;position:sticky;top:148px;background:var(--bg);z-index:10}
.date-day{font-family:'Fraunces',serif;font-size:1rem;font-weight:600}
.date-weekday{font-size:0.68rem;font-weight:600;color:var(--light);text-transform:uppercase;letter-spacing:0.04em}
.date-badge{font-size:0.55rem;font-weight:700;color:#fff;padding:0.06rem 0.3rem;border-radius:4px;margin-left:auto}
.date-badge.today{background:#27AE60}
.date-badge.tomorrow{background:#2980B9}

/* EVENT CARDS */
.events-list{display:flex;flex-direction:column;gap:0.2rem}
.ev{display:flex;gap:0.45rem;padding:0.45rem 0.55rem;background:var(--card);border-radius:var(--radius);border-left:4px solid transparent;transition:all 0.1s;align-items:flex-start}
.ev:hover{box-shadow:0 2px 8px rgba(0,0,0,0.05);transform:translateY(-1px)}
.ev.hidden{display:none}
.ev-time{flex-shrink:0;width:44px;text-align:center;padding-top:0.08rem}
.ev-time .t{font-size:0.72rem;font-weight:700;line-height:1.2}
.ev-time .p{font-size:0.55rem;font-weight:600;color:var(--light);text-transform:uppercase}
.ev-body{flex:1;min-width:0}
.ev-name{font-weight:700;font-size:0.8rem;line-height:1.22}
.ev-meta{font-size:0.68rem;color:var(--mid);line-height:1.3;margin-top:0.03rem}
.ev-tags{display:flex;gap:0.18rem;flex-wrap:wrap;margin-top:0.18rem}
.ev-cat{font-size:0.55rem;font-weight:700;padding:0.06rem 0.32rem;border-radius:3px;text-transform:uppercase;letter-spacing:0.03em}
.ev-loc{font-size:0.55rem;font-weight:500;padding:0.06rem 0.28rem;border-radius:3px;background:#F0EDE8;color:var(--mid)}
.ev-price{font-size:0.55rem;font-weight:600;padding:0.06rem 0.28rem;border-radius:3px;background:#E2F5E9;color:#1B7A3D}
.ev-freq{font-size:0.52rem;font-weight:600;padding:0.05rem 0.25rem;border-radius:3px}
.ev-freq.oneoff{background:#FFE8D6;color:#A0522D}
.ev-freq.special{background:#E8D5F5;color:#6B3FA0}
.ev-freq.daily{background:#D4EDDA;color:#155724}
.ev-freq.biweekly{background:#FFF3CD;color:#856404}

.gcal{flex-shrink:0;display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;border:1.5px solid var(--border);background:var(--card);cursor:pointer;transition:all 0.12s;margin-top:0.08rem;text-decoration:none}
.gcal:hover{border-color:#4285F4;background:#EBF2FF}
.gcal svg{width:13px;height:13px}

.empty-state{text-align:center;padding:3rem 1rem;color:var(--light);font-size:0.85rem}

@media(max-width:480px){
  .header{padding:1.1rem 0.8rem 0.7rem}
  .header h1{font-size:1.15rem}
  .filter-panel{top:74px;padding:0.35rem 0.6rem 0.4rem}
  .date-header{top:140px}
  main{padding:0.3rem 0.5rem 3rem}
}
</style>
</head>
<body>

<div class="header">
  <h1>Cape Town Events Calendar</h1>
  <p class="sub">All neighborhoods Â· Recurring + special events Â· Febâ€“Jun 2026</p>
  <div class="header-row">
    <div class="month-nav">
      <button class="month-btn" id="prevMonth">â—‚</button>
      <div class="month-label" id="monthLabel"></div>
      <button class="month-btn" id="nextMonth">â–¸</button>
    </div>
    <div class="ev-counter"><span id="evCount">0</span> events</div>
  </div>
</div>

<div class="filter-panel">
  <div class="filter-section" id="catFilters">
    <span class="filter-label">Type</span>
  </div>
  <div class="filter-section" id="hoodFilters">
    <span class="filter-label">Area</span>
  </div>
</div>

<main id="main"></main>

<script>
// â”€â”€ CONSOLIDATED CATEGORIES (18 â†’ 9) â”€â”€
const CATS={
  music:    {l:"Music",     c:"#C2553A", bg:"#FAEAE6", icon:"ðŸŽµ"},
  wellness: {l:"Wellness",  c:"#7B5EA7", bg:"#F3EEF8", icon:"ðŸ§˜"},
  family:   {l:"Family",    c:"#E67E22", bg:"#FDF1E3", icon:"ðŸ‘¶"},
  spiritual:{l:"Spiritual", c:"#8A5BA5", bg:"#F2ECF6", icon:"âœ¨"},
  market:   {l:"Markets",   c:"#C0392B", bg:"#FBEAE8", icon:"ðŸ›’"},
  fitness:  {l:"Fitness",   c:"#3C8F3C", bg:"#E7F3E7", icon:"ðŸƒ"},
  ideas:    {l:"Ideas",     c:"#4A5899", bg:"#ECEEF8", icon:"ðŸ’­"},
  creative: {l:"Creative",  c:"#A0522D", bg:"#F8EDE5", icon:"ðŸŽ¨"},
  social:   {l:"Social",    c:"#27AE60", bg:"#E5F6EC", icon:"ðŸ¤"},
};

// â”€â”€ NEIGHBORHOODS â”€â”€
const HOODS={
  muiz:    {l:"Muizenberg"},
  falsebay:{l:"False Bay"},
  cpt:     {l:"CBD / Gardens"},
  atlantic:{l:"Atlantic"},
  obs:     {l:"Obs / Woodstock"},
  south:   {l:"Southern Suburbs"},
  deep:    {l:"Deep South"},
  hout:    {l:"Hout Bay"},
  stell:   {l:"Stellenbosch"},
  other:   {l:"Other"},
};

function locToHood(loc){
  const l=(loc||'').toLowerCase();
  if(/muizenberg|york rd|surfer|commons|albertyn|church st.*muiz/i.test(l))return 'muiz';
  if(/kalk bay|st james|fish hoek|simon|false bay|dalebrook|kirstenhof/i.test(l))return 'falsebay';
  if(/sea point|regent rd|green point|mouille|waterkant|waterfront|de waterkant/i.test(l))return 'atlantic';
  if(/observatory|woodstock|biscuit mill|bee-stro|lower main/i.test(l))return 'obs';
  if(/cbd|bree st|wale st|roeland|hatfield|gardens|kloof st|buitengracht|cathedral|baran|hout st.*cbd|cticc/i.test(l))return 'cpt';
  if(/claremont|newlands|rondebosch|kenilworth|harfield|constantia|alphen|diep river|tokai|sufi temple|plumstead|bergvliet|wynberg|civic centre/i.test(l))return 'south';
  if(/noordhoek|kommetjie|scarborough|cape point vin/i.test(l))return 'deep';
  if(/hout bay|harbour/i.test(l))return 'hout';
  if(/stellenbosch|root 44/i.test(l))return 'stell';
  if(/kirstenbosch/i.test(l))return 'south';
  return 'other';
}

// â”€â”€ EVENTS DATA â”€â”€
// Merged categories: jazz/music/openmicâ†’music, yoga/meditation/swim/surfâ†’wellness,
// kids/festivalâ†’family, philosophy/books/shadowâ†’ideas, art/workshopâ†’creative
const REC=[
  // MONDAY
  {day:0,time:"6:00am",s:600,n:"Mysore Ashtanga",loc:"AYCT, Vredehoek",d:"Monâ€“Thu 6â€“8am. Trained with Sharath Jois",cat:"wellness",freq:"w"},
  {day:0,time:"6:30pm",s:1830,n:"Diamond Way Buddhist Meditation",loc:"Cape Town CBD",d:"Intro meditation every Monday",cat:"wellness",freq:"w"},
  {day:0,time:"6:30pm",s:1830,n:"Famous Butchers Jazz Duo",loc:"Green Point",d:"JosÃ© & Nelson 6:30â€“9:30pm. Also Wed & Fri",cat:"music",freq:"w"},
  {day:0,time:"7:00pm",s:1900,n:"Fat Harry's Jazz Jam",loc:"Kenilworth",d:"Hosted by Dan Shout. Free jammers / R50 listen",cat:"music",price:"Free/R50",freq:"w"},
  {day:0,time:"7:00pm",s:1900,n:"Cape Town Writers' Network",loc:"The Bee-stro, Observatory",d:"Weekly workshops. Free (buy food/drink)",cat:"ideas",price:"Free",freq:"w"},
  {day:0,time:"8:00am",s:800,n:"Waterblommetjies Cold Swim",loc:"Camps Bay Tidal Pool",d:"Women's cold-water group",cat:"wellness",price:"Free",freq:"w"},
  {day:0,time:"8:00pm",s:2000,n:"Armchair Theatre Jam Night",loc:"Observatory",d:"Open jam. 135 Lower Main Rd",cat:"music",price:"Free",freq:"w"},
  {day:0,time:"Evening",s:1930,n:"Ananda Kutir Monday Programme",loc:"Rondebosch East",d:"Marâ€“Jul. Yoga, meditation, discourse",cat:"spiritual",freq:"w"},
  {day:0,time:"Evening",s:1900,n:"Zen Meditation",loc:"Sufi Temple, Newlands",d:"Chanting, sitting, walking meditation, teachings",cat:"wellness",freq:"w"},

  // TUESDAY
  {day:1,time:"6:00am",s:600,n:"Mysore Ashtanga",loc:"AYCT, Vredehoek",d:"Monâ€“Thu 6â€“8am",cat:"wellness",freq:"w"},
  {day:1,time:"8:00am",s:800,n:"Running Wild Trail Run",loc:"False Bay",d:"Tue & Thu 8am. Beginner-friendly",cat:"fitness",freq:"w"},
  {day:1,time:"Morning",s:900,n:"Moms on Board â€” Free Surf",loc:"Lifestyle Surf Shop, Muizenberg",d:"Free surf lessons for moms every Tuesday",cat:"wellness",price:"Free",freq:"w"},
  {day:1,time:"Morning",s:930,n:"Wriggle and Rhyme",loc:"Claremont / Rondebosch",d:"Music & movement 6moâ€“6yr",cat:"family",freq:"w"},
  {day:1,time:"6:00pm",s:1800,n:"Ground Culture Open Mic",loc:"170 Lower Main Rd, Observatory",d:"6â€“10pm. All welcome",cat:"music",price:"Free",freq:"w"},
  {day:1,time:"6:30pm",s:1830,n:"Rotary â€” Cape of Good Hope",loc:"Galley Restaurant, Fish Hoek",d:"Weekly dinner meeting",cat:"social",freq:"w"},
  {day:1,time:"7:00pm",s:1900,n:"Kagyu Samye Dzong Meditation",loc:"Kenilworth",d:"Tibetan Buddhist. R60/class",cat:"wellness",price:"R60",freq:"w"},
  {day:1,time:"7:30pm",s:1930,n:"Amber on Bree Jazz Jam",loc:"CBD",d:"Curated by Muneeb Hermans",cat:"music",price:"Free",freq:"w"},
  {day:1,time:"7:30pm",s:1930,n:"Mojo Market Jazzy Tuesdays",loc:"30 Regent Rd, Sea Point",d:"Live jazz",cat:"music",freq:"w"},
  {day:1,time:"8:00pm",s:2000,n:"House of Machines Songwriter Showcase",loc:"CBD",d:"Every Tuesday",cat:"music",price:"Free",freq:"w"},
  {day:1,time:"8:00pm",s:2000,n:"Asoka Free Jazz",loc:"68 Kloof St, Gardens",d:"Free jazz from 8pm",cat:"music",price:"Free",freq:"w"},

  // WEDNESDAY
  {day:2,time:"6:00am",s:600,n:"Mysore Ashtanga",loc:"AYCT, Vredehoek",d:"Monâ€“Thu 6â€“8am",cat:"wellness",freq:"w"},
  {day:2,time:"8:00am",s:800,n:"Noordhoek Yoga Collective",loc:"9A Noordhoek Main Rd",d:"Open Vinyasa 8â€“9am. R150",cat:"wellness",price:"R150",freq:"w"},
  {day:2,time:"10:00am",s:1000,n:"Zeitz MOCAA â€” Africa Wednesdays",loc:"V&A Waterfront",d:"Free for African citizens 10amâ€“1pm",cat:"creative",price:"Free",freq:"w"},
  {day:2,time:"6:30pm",s:1830,n:"Famous Butchers Jazz Duo",loc:"Green Point",d:"JosÃ© & Nelson 6:30â€“9:30pm",cat:"music",freq:"w"},
  {day:2,time:"7:00pm",s:1900,n:"The Melting Pot Live Music",loc:"15 Church St, Muizenberg",d:"Jazz, folk, rock, comedy",cat:"music",freq:"w"},
  {day:2,time:"7:00pm",s:1900,n:"The Blue Room Jazz",loc:"Grub & Vine, CBD",d:"Speakeasy. R200 (R100 Tue)",cat:"music",price:"R200",freq:"w"},
  {day:2,time:"7:00pm",s:1900,n:"The Crypt Jazz",loc:"St George's Cathedral, CBD",d:"In the crypt. Tueâ€“Sat from 7pm",cat:"music",price:"R50â€“R100",freq:"w"},
  {day:2,time:"8:00pm",s:2000,n:"Striped Horse Open Jam",loc:"York Rd, Muizenberg",d:"Bi-weekly 8â€“11pm. Ted Bauman",cat:"music",price:"Free",freq:"bw"},

  // THURSDAY
  {day:3,time:"6:00am",s:600,n:"Mysore Ashtanga",loc:"AYCT, Vredehoek",d:"Monâ€“Thu 6â€“8am",cat:"wellness",freq:"w"},
  {day:3,time:"8:00am",s:800,n:"Running Wild Trail Run",loc:"False Bay",d:"Tue & Thu 8am",cat:"fitness",freq:"w"},
  {day:3,time:"Morning",s:900,n:"Stories and Voices Writing",loc:"Newlands",d:"AWA method workshops. ~2 hours",cat:"ideas",freq:"w"},
  {day:3,time:"Morning",s:930,n:"Fish Hoek Library Story Hour",loc:"Fish Hoek",d:"Running since the 1950s",cat:"family",price:"Free",freq:"w"},
  {day:3,time:"4:00pm",s:1600,n:"Blue Bird Garage Market",loc:"39 Albertyn Rd, Muizenberg",d:"Thu & Fri 4â€“10pm. Live bands, food, Kids Zone",cat:"market",price:"Free entry",freq:"w"},
  {day:3,time:"4:30pm",s:1630,n:"Cape Point Vineyards Market",loc:"Cape Point Vineyards, Noordhoek",d:"Summer 4:30â€“8:30pm. Music, sunset, kids' area",cat:"market",price:"Free entry",freq:"w"},
  {day:3,time:"6:00pm",s:1800,n:"Harvest CafÃ© Open Mic",loc:"York Rd, Muizenberg",d:"6â€“9pm. Singers, poets, musicians",cat:"music",price:"Free",freq:"w"},
  {day:3,time:"6:30pm",s:1830,n:"Dance Awake Ecstatic Dance",loc:"Claremont Civic Centre",d:"Conscious dance / moving meditation. R150",cat:"wellness",price:"R150",freq:"w"},
  {day:3,time:"6:30pm",s:1830,n:"Rotary â€” South Peninsula",loc:"Fish Hoek Beach",d:"Weekly meeting",cat:"social",freq:"w"},
  {day:3,time:"6:30pm",s:1830,n:"Famous Butchers Jazz Duo",loc:"Green Point",d:"JosÃ© & Nelson 6:30â€“9:30pm",cat:"music",freq:"w"},
  {day:3,time:"7:00pm",s:1900,n:"Incognito Bar Jazz",loc:"The Alphen, Constantia",d:"Jazz with tapas 7â€“9:30pm",cat:"music",freq:"w"},
  {day:3,time:"7:00pm",s:1900,n:"Tiger's Milk Live Music",loc:"Claremont",d:"Thu evening 7â€“9pm",cat:"music",freq:"w"},
  {day:3,time:"9:00pm",s:2100,n:"Athletic Club Jazz Thursdays",loc:"35 Buitengracht St, CBD",d:"From 9pm. R200",cat:"music",price:"R200",freq:"w"},

  // FRIDAY
  {day:4,time:"6:00am",s:600,n:"Led Primary Ashtanga",loc:"AYCT, Vredehoek",d:"Friday 6am led class",cat:"wellness",freq:"w"},
  {day:4,time:"Morning",s:900,n:"Roam Parenting Playgroup",loc:"Cape Town",d:"Guided 90-min. RIE + mindfulness",cat:"family",freq:"w"},
  {day:4,time:"10:30am",s:1030,n:"Waterblommetjies Cold Swim",loc:"Camps Bay Tidal Pool",d:"Women's group Fri 10:30am",cat:"wellness",price:"Free",freq:"w"},
  {day:4,time:"4:00pm",s:1600,n:"Blue Bird Garage Market",loc:"39 Albertyn Rd, Muizenberg",d:"Thu & Fri 4â€“10pm",cat:"market",price:"Free entry",freq:"w"},
  {day:4,time:"5:00pm",s:1700,n:"Bay Harbour Market",loc:"31 Harbour Rd, Hout Bay",d:"KWV Sound Stage Fri 5â€“9pm",cat:"market",freq:"w"},
  {day:4,time:"Evening",s:1900,n:"Temple Israel Shabbat",loc:"Wynberg",d:"Fri night. Hebrew & English. All welcome",cat:"spiritual",freq:"w"},
  {day:4,time:"Evening",s:1900,n:"Muizenberg Synagogue Shabbat",loc:"Muizenberg",d:"Fri evening. Historic 1920s Orthodox",cat:"spiritual",freq:"w"},
  {day:4,time:"Evening",s:1900,n:"Kaleidoscope CafÃ© Jazz",loc:"Claremont",d:"Jazz Fridays since 2005. ~R120 inc. dinner",cat:"music",price:"~R120",freq:"w"},
  {day:4,time:"7:30pm",s:1930,n:"The Piano Bar",loc:"47 Napier St, De Waterkant",d:"Live jazz/soul/funk every night. No cover",cat:"music",price:"Free",freq:"w"},

  // SATURDAY
  {day:5,time:"8:00am",s:800,n:"Zandvlei parkrun",loc:"Muizenberg",d:"5km flat. Pushchairs + dogs welcome",cat:"fitness",price:"Free",freq:"w"},
  {day:5,time:"8:00am",s:800,n:"Fish Hoek parkrun",loc:"Fish Hoek",d:"5km gravel/trail",cat:"fitness",price:"Free",freq:"w"},
  {day:5,time:"8:00am",s:800,n:"Hout Bay parkrun",loc:"Ambleside School, Hout Bay",d:"Post-run coffee at Roots",cat:"fitness",price:"Free",freq:"w"},
  {day:5,time:"8:00am",s:800,n:"Root 44 parkrun",loc:"Stellenbosch",d:"Through vineyards. 900â€“1,500 runners",cat:"fitness",price:"Free",freq:"w"},
  {day:5,time:"9:00am",s:900,n:"Neighbourgoods Market",loc:"Old Biscuit Mill, Woodstock",d:"9amâ€“3pm. 100+ traders, live music",cat:"market",price:"Free entry",freq:"w"},
  {day:5,time:"9:00am",s:900,n:"OZCF Market",loc:"V&A Waterfront",d:"Saturday farmers' market",cat:"market",freq:"w"},
  {day:5,time:"9:00am",s:900,n:"Oranjezicht City Farm Market",loc:"Granger Bay, V&A Waterfront",d:"40+ farmers, 80+ traders",cat:"market",freq:"w"},
  {day:5,time:"9:30am",s:930,n:"Anthony Shapiro Pottery",loc:"CBD",d:"Drop-in Sat 9:30amâ€“12:30pm. R1,200",cat:"creative",price:"R1,200",freq:"w"},
  {day:5,time:"Morning",s:930,n:"Temple Israel Saturday Morning",loc:"Wynberg",d:"All welcome",cat:"spiritual",freq:"w"},
  {day:5,time:"3:00pm",s:1500,n:"Cool Runnings Jazz",loc:"Harfield Village, Claremont",d:"Sat 3â€“6pm (biweekly)",cat:"music",freq:"bw"},
  {day:5,time:"6:00pm",s:1800,n:"ISKCON Spirit Matters",loc:"Rondebosch",d:"Kirtan + discussions",cat:"spiritual",freq:"w"},
  {day:5,time:"Evening",s:1900,n:"Ananda Kutir Satsang",loc:"Rondebosch East",d:"Kirtans, discourse, prasad. Free (booking req)",cat:"spiritual",price:"Free",freq:"w"},

  // SUNDAY
  {day:6,time:"9:30am",s:930,n:"Quaker Meeting",loc:"Mowbray / South Peninsula homes",d:"Silent worship. No leaders, no creed",cat:"spiritual",price:"Free",freq:"w"},
  {day:6,time:"10:00am",s:1000,n:"Southreach Church",loc:"Muizenberg",d:"Multicultural. Also 6pm evening",cat:"spiritual",freq:"w"},
  {day:6,time:"10:00am",s:1000,n:"Cape Town Unitarians",loc:"64 Hout St, CBD",d:"Multifaith. No dogma. All welcome",cat:"spiritual",freq:"w"},
  {day:6,time:"11:00am",s:1100,n:"ISKCON Sunday Love Feast",loc:"Rondebosch",d:"Chanting, discourse, free vegetarian lunch",cat:"spiritual",price:"Free",freq:"w"},
  {day:6,time:"1:00pm",s:1300,n:"Kloof St House Sunday Jazz",loc:"Gardens",d:"Free 1â€“3pm on veranda. Family-friendly",cat:"music",price:"Free",freq:"w"},
  {day:6,time:"1:00pm",s:1300,n:"Woodstock Brewery Jazz",loc:"Woodstock",d:"Glenn Robertson Band. R140",cat:"music",price:"R140",freq:"w"},
  {day:6,time:"1:00pm",s:1300,n:"Mojo Market Sunday Jazz",loc:"30 Regent Rd, Sea Point",d:"Jazz Cats from 1pm",cat:"music",price:"Free",freq:"w"},
  {day:6,time:"Afternoon",s:1400,n:"Lekker Chats",loc:"Cape Town",d:"Structured conversation. 2Ã—/month. Ages 25â€“45",cat:"ideas",price:"Free",freq:"bw"},
  {day:6,time:"Afternoon",s:1400,n:"Silent Book Club",loc:"The Commons, Muizenberg",d:"Bring any book, read, socialize",cat:"ideas",price:"Free",freq:"w"},
  {day:6,time:"3:00pm",s:1500,n:"Curious to Change",loc:"Cape Town",d:"Deep conversation / personal development",cat:"ideas",freq:"w"},
  {day:6,time:"3:00pm",s:1500,n:"The Shed Jazz Jam",loc:"165 Main Rd, Muizenberg",d:"Bring instruments! Free",cat:"music",price:"Free",freq:"w"},
  {day:6,time:"3:00pm",s:1500,n:"Pakalolo Sunday Jazz",loc:"10 Main Rd, Hout Bay",d:"Live jazz Sundays",cat:"music",freq:"w"},
  {day:6,time:"4:00pm",s:1600,n:"Openwine Sunday Jazz",loc:"72 Wale St, CBD",d:"Every Sunday 4pm. Free",cat:"music",price:"Free",freq:"w"},
  {day:6,time:"4:00pm",s:1600,n:"Kirstenbosch Sunset Concert",loc:"Kirstenbosch, Newlands",d:"Sun Novâ€“Mar. Kids 0â€“5 free. R360",cat:"family",price:"R360",freq:"w"},

  // DAILY
  {day:-1,time:"Dawn",s:500,n:"Dalebrook Dawn Swim",loc:"Dalebrook Tidal Pool, Kalk Bay",d:"Community of 'swimrisers'. Year-round",cat:"wellness",price:"Free",freq:"d"},
  {day:-1,time:"Morning",s:700,n:"Surfer's Corner",loc:"Muizenberg Beach",d:"Multiple schools. Warm gentle waves",cat:"wellness",freq:"d"},
  {day:-1,time:"11:00am",s:1100,n:"Mojo Market Live Music",loc:"30 Regent Rd, Sea Point",d:"Live music every day 11amâ€“9pm",cat:"music",price:"Free",freq:"d"},

  // MONTHLY
  {day:1,time:"8:00pm",s:2000,n:"UCT Philosophy Society",loc:"UCT, Rondebosch",d:"1st Tue. Lecture 8â€“9:30pm + port discussion",cat:"ideas",price:"Free",freq:"m1"},
  {day:3,time:"Evening",s:1900,n:"First Thursdays Cape Town",loc:"CBD Galleries",d:"1st Thu. ~35 galleries open til 9pm+",cat:"creative",price:"Free",freq:"m1"},
  {day:3,time:"Evening",s:1900,n:"First Thursdays Down South",loc:"Muizenberg / Kalk Bay",d:"1st Thu. Local galleries, shops, bars",cat:"creative",price:"~R200",freq:"m1"},
  {day:1,time:"Evening",s:1900,n:"Third House Poetry",loc:"Cape Town CBD",d:"Last Tue. Cape Town's premier spoken word",cat:"music",price:"~R60",freq:"mL"},
  {day:2,time:"Evening",s:1930,n:"Verses Spoken Word",loc:"Baran's, CBD",d:"Last Wed. Poetry + live band + open mic",cat:"music",freq:"mL"},
  {day:0,time:"7:00pm",s:1900,n:"Fish Hoek Lions Club",loc:"Fish Hoek Bowling Club",d:"2nd Mon. Leos for youth 12â€“18",cat:"social",freq:"m2"},
  {day:5,time:"2:30pm",s:1430,n:"Bergvliet Writers' Circle",loc:"Diep River",d:"2nd Sat. Running 25+ years",cat:"ideas",freq:"m2"},
  {day:5,time:"9:00am",s:900,n:"Jean Knighton-Fitt Retreat",loc:"Cape Town",d:"3rd Sat 9amâ€“1pm. Writing + silent exercises",cat:"ideas",freq:"m3"},
  {day:5,time:"9:00am",s:900,n:"All About Writing",loc:"Casa Labia, Muizenberg",d:"1st Sat. Creative writing. R425",cat:"creative",price:"R425",freq:"m1"},
  {day:4,time:"Evening",s:1900,n:"Alliance FranÃ§aise Jazz",loc:"CBD",d:"Last Fri. R80",cat:"music",price:"R80",freq:"mL"},
  {day:3,time:"Evening",s:1900,n:"Pakalolo Comedy Night",loc:"10 Main Rd, Hout Bay",d:"Last Thu monthly",cat:"social",freq:"mL"},
];

const ONEOFF=[
  {date:"2026-02-20",time:"Evening",s:1900,n:"Galileo Cinema: The Wild Robot",loc:"Kirstenbosch",d:"Open air. Family-friendly",cat:"family",price:"R155"},
  {date:"2026-02-21",time:"9:00am",s:900,n:"Mercury Woodwork: Parent & Child",loc:"Cape Town",d:"Special parent + child session",cat:"creative"},
  {date:"2026-03-01",time:"4:00pm",s:1600,n:"Kirstenbosch: Derek Gripper",loc:"Kirstenbosch, Newlands",d:"Classical guitar master",cat:"music",price:"R360"},
  {date:"2026-03-03",time:"7:00pm",s:1900,n:"Opera UCT 2026 Season Launch",loc:"Baxter Theatre, Rondebosch",d:"Annual opera season launch",cat:"creative"},
  {date:"2026-03-08",time:"4:00pm",s:1600,n:"Kirstenbosch: Matthew Mole",loc:"Kirstenbosch, Newlands",d:"SA indie-pop sunset concert",cat:"music",price:"R360"},
  {date:"2026-03-21",time:"Evening",s:1800,n:"Cape Town Carnival ðŸŽ­",loc:"CBD, Cape Town",d:"Free street carnival. Human Rights Day",cat:"family",price:"Free"},
  {date:"2026-03-23",time:"Daytime",s:1000,n:"Stellenbosch Piano Symposium",loc:"Stellenbosch",d:"Free public rounds â€” day 1",cat:"music",price:"Free"},
  {date:"2026-03-24",time:"Daytime",s:1000,n:"Stellenbosch Piano Symposium",loc:"Stellenbosch",d:"Free public rounds â€” day 2",cat:"music",price:"Free"},
  {date:"2026-03-27",time:"5:00pm",s:1700,n:"CT Jazz Festival â€” Day 1 ðŸŽ·",loc:"CTICC, CBD",d:"Jacob Collier, Nduduzo Makhathini, BCUC",cat:"music",price:"R950+"},
  {date:"2026-03-27",time:"Evening",s:1900,n:"Galileo Cinema: The Lion King",loc:"Kirstenbosch",d:"Open air cinema. Family classic",cat:"family",price:"R155"},
  {date:"2026-03-28",time:"5:00pm",s:1700,n:"CT Jazz Festival â€” Day 2 ðŸŽ·",loc:"CTICC, CBD",d:"Scorpion Kings + full lineup",cat:"music",price:"R950+"},
  {date:"2026-03-28",time:"7:00pm",s:1900,n:"Stellenbosch Piano Final",loc:"Stellenbosch",d:"Competition final",cat:"music",price:"R165+"},
  {date:"2026-03-29",time:"4:00pm",s:1600,n:"CT Philharmonic: Peter & the Wolf ðŸº",loc:"Kirstenbosch, Newlands",d:"Children's concert! Kids 0â€“5 free",cat:"family",price:"R360"},
  {date:"2026-04-10",time:"5:00pm",s:1700,n:"ManKind Project Adventure ðŸ”¥",loc:"Cape Town",d:"Shadow work weekend. K/W/M/L archetypes",cat:"ideas"},
  {date:"2026-04-11",time:"All day",s:800,n:"ManKind Project â€” Day 2",loc:"Cape Town",d:"Continues from Friday",cat:"ideas"},
  {date:"2026-04-12",time:"Morning",s:800,n:"ManKind Project â€” Day 3",loc:"Cape Town",d:"Closing circle",cat:"ideas"},
  {date:"2026-04-27",time:"Daytime",s:1000,n:"Freedom Day ðŸ‡¿ðŸ‡¦",loc:"Cape Town",d:"National holiday. Museums, events",cat:"family",price:"Free"},
  {date:"2026-05-01",time:"Daytime",s:1000,n:"Workers' Day",loc:"Cape Town",d:"Public holiday",cat:"family",price:"Free"},
  {date:"2026-06-16",time:"Daytime",s:1000,n:"Youth Day ðŸ‡¿ðŸ‡¦",loc:"Cape Town",d:"Public holiday",cat:"family",price:"Free"},
];

// â”€â”€ UTILITIES â”€â”€
const addDays=(d,n)=>{const r=new Date(d);r.setDate(r.getDate()+n);return r};
const fmtDate=d=>d.toISOString().slice(0,10);
const parseDate=s=>{const[y,m,d]=s.split('-').map(Number);return new Date(y,m-1,d)};
const ourDayToJS=d=>d===6?0:(d+1);
function nthWeekday(y,m,wd,n){
  if(n>0){const f=new Date(y,m,1);return new Date(y,m,1+(wd-f.getDay()+7)%7+(n-1)*7);}
  const l=new Date(y,m+1,0);return new Date(y,m,l.getDate()-(l.getDay()-wd+7)%7);
}

function generateEvents(start,end){
  const evs={};
  const add=(ds,ev)=>{if(!evs[ds])evs[ds]=[];evs[ds].push({...ev,hood:locToHood(ev.loc)});};
  REC.forEach(r=>{
    if(r.freq==='d'){let c=new Date(start);while(c<=end){add(fmtDate(c),r);c=addDays(c,1);}return;}
    if(r.freq==='w'||r.freq==='bw'){
      const js=ourDayToJS(r.day);let c=new Date(start);
      while(c.getDay()!==js)c=addDays(c,1);
      const step=r.freq==='bw'?14:7;
      while(c<=end){add(fmtDate(c),r);c=addDays(c,step);}return;
    }
    if(r.freq.startsWith('m')){
      const js=ourDayToJS(r.day),w=r.freq.slice(1);
      let m=start.getMonth(),y=start.getFullYear();
      for(let i=0;i<6;i++){
        const dt=nthWeekday(y,m,js,w==='L'?-1:parseInt(w));
        if(dt>=start&&dt<=end)add(fmtDate(dt),{...r,_monthly:true});
        m++;if(m>11){m=0;y++;}
      }
    }
  });
  ONEOFF.forEach(o=>{const dt=parseDate(o.date);if(dt>=start&&dt<=end)add(o.date,{...o,_oneoff:true});});
  Object.keys(evs).forEach(k=>evs[k].sort((a,b)=>a.s-b.s));
  return evs;
}

// â”€â”€ STATE â”€â”€
const MONTHS=[
  {label:"February 2026",start:new Date(2026,1,17),end:new Date(2026,1,28)},
  {label:"March 2026",start:new Date(2026,2,1),end:new Date(2026,2,31)},
  {label:"April 2026",start:new Date(2026,3,1),end:new Date(2026,3,30)},
  {label:"May 2026",start:new Date(2026,4,1),end:new Date(2026,4,31)},
  {label:"June 2026",start:new Date(2026,5,1),end:new Date(2026,5,30)},
];
let curMonth=0;
let catState={};Object.keys(CATS).forEach(k=>catState[k]=true);
let hoodState={};Object.keys(HOODS).forEach(k=>hoodState[k]=true);

const DN=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
const MN=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function gcalUrl(ev,ds){
  const dt=parseDate(ds);
  let sH=9,sM=0;const tm=(ev.time||'').match(/(\d{1,2}):?(\d{2})?\s*(am|pm)?/i);
  if(tm){sH=parseInt(tm[1]);sM=tm[2]?parseInt(tm[2]):0;if(tm[3]&&tm[3].toLowerCase()==='pm'&&sH<12)sH+=12;if(tm[3]&&tm[3].toLowerCase()==='am'&&sH===12)sH=0;}
  else if(/morning/i.test(ev.time))sH=9;else if(/afternoon/i.test(ev.time))sH=14;else if(/evening/i.test(ev.time))sH=19;else if(/dawn/i.test(ev.time))sH=6;else if(/daytime|all/i.test(ev.time))sH=10;
  const p=n=>String(n).padStart(2,'0');
  const ss=`${dt.getFullYear()}${p(dt.getMonth()+1)}${p(dt.getDate())}T${p(sH)}${p(sM)}00`;
  const es=`${dt.getFullYear()}${p(dt.getMonth()+1)}${p(dt.getDate())}T${p(sH+1)}${p(sM)}00`;
  return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(ev.n)}&dates=${ss}/${es}&ctz=Africa/Johannesburg&location=${encodeURIComponent((ev.loc||'')+', Cape Town')}&details=${encodeURIComponent([ev.d,ev.price?'Price: '+ev.price:''].filter(Boolean).join('\n'))}`;
}

function freqLabel(ev){
  if(ev._oneoff)return '<span class="ev-freq oneoff">One-off</span>';
  if(ev._monthly)return '<span class="ev-freq special">Monthly</span>';
  if(ev.freq==='bw')return '<span class="ev-freq biweekly">Bi-weekly</span>';
  if(ev.freq==='d')return '<span class="ev-freq daily">Daily</span>';
  return '';
}

function isVisible(ev){return catState[ev.cat]&&hoodState[ev.hood]}

function renderCard(ev,ds){
  const c=CATS[ev.cat]||{l:'?',c:'#666',bg:'#eee'};
  const h=HOODS[ev.hood]||{l:'Other'};
  return `<div class="ev${isVisible(ev)?'':' hidden'}" data-cat="${ev.cat}" data-hood="${ev.hood}" style="border-left-color:${c.c}">
    <div class="ev-time"><div class="t">${(ev.time||'').replace(/am/i,'').replace(/pm/i,'')}</div><div class="p">${/am/i.test(ev.time)?'AM':/pm/i.test(ev.time)?'PM':''}</div></div>
    <div class="ev-body">
      <div class="ev-name">${ev.n}</div>
      <div class="ev-meta">${ev.d||''}</div>
      <div class="ev-tags">
        <span class="ev-cat" style="background:${c.bg};color:${c.c}">${c.l}</span>
        <span class="ev-loc">${h.l}</span>
        ${ev.price?`<span class="ev-price">${ev.price}</span>`:''}
        ${freqLabel(ev)}
      </div>
    </div>
    <a class="gcal" href="${gcalUrl(ev,ds)}" target="_blank" rel="noopener" title="Add to Google Calendar">
      <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="4" width="18" height="18" rx="2" stroke="${c.c}" stroke-width="2"/><path d="M3 10h18" stroke="${c.c}" stroke-width="2"/><path d="M8 2v4M16 2v4" stroke="${c.c}" stroke-width="2" stroke-linecap="round"/><path d="M8 14h2v2H8zM14 14h2v2h-2z" fill="${c.c}"/></svg>
    </a>
  </div>`;
}

function render(){
  const mo=MONTHS[curMonth];
  document.getElementById('monthLabel').textContent=mo.label;
  document.getElementById('prevMonth').disabled=curMonth===0;
  document.getElementById('nextMonth').disabled=curMonth===MONTHS.length-1;
  const evs=generateEvents(mo.start,mo.end);
  const dates=Object.keys(evs).sort();
  const today=fmtDate(new Date()),tmrw=fmtDate(addDays(new Date(),1));
  let html='',total=0;
  dates.forEach(ds=>{
    const dayEvs=evs[ds];
    const vis=dayEvs.filter(isVisible).length;
    if(!vis)return;
    total+=vis;
    const dt=parseDate(ds);
    let badge='';
    if(ds===today)badge='<span class="date-badge today">Today</span>';
    else if(ds===tmrw)badge='<span class="date-badge tomorrow">Tomorrow</span>';
    html+=`<div class="date-group"><div class="date-header"><span class="date-day">${dt.getDate()} ${MN[dt.getMonth()]}</span><span class="date-weekday">${DN[dt.getDay()]}</span>${badge}</div><div class="events-list">${dayEvs.map(e=>renderCard(e,ds)).join('')}</div></div>`;
  });
  if(!html)html='<div class="empty-state">No events match your filters for this month</div>';
  document.getElementById('main').innerHTML=html;
  document.getElementById('evCount').textContent=total;
}

function buildFilters(){
  // Category filters
  const cf=document.getElementById('catFilters');
  cf.innerHTML='<span class="filter-label">Type</span>'+
    Object.entries(CATS).map(([k,c])=>`<span class="ftag" data-cat="${k}"><span class="dot" style="background:${c.c}"></span>${c.l}</span>`).join('')+
    '<span class="select-btns"><span class="sel-btn" id="selAllCat">All</span><span class="sel-btn" id="selNoneCat">None</span></span>';

  cf.querySelectorAll('.ftag').forEach(t=>t.addEventListener('click',()=>{
    const k=t.dataset.cat;catState[k]=!catState[k];t.classList.toggle('off');render();
  }));
  document.getElementById('selAllCat').addEventListener('click',()=>{Object.keys(CATS).forEach(k=>catState[k]=true);cf.querySelectorAll('.ftag').forEach(t=>t.classList.remove('off'));render();});
  document.getElementById('selNoneCat').addEventListener('click',()=>{Object.keys(CATS).forEach(k=>catState[k]=false);cf.querySelectorAll('.ftag').forEach(t=>t.classList.add('off'));render();});

  // Neighborhood filters
  const hf=document.getElementById('hoodFilters');
  hf.innerHTML='<span class="filter-label">Area</span>'+
    Object.entries(HOODS).map(([k,h])=>`<span class="ftag" data-hood="${k}">${h.l}</span>`).join('')+
    '<span class="select-btns"><span class="sel-btn" id="selAllHood">All</span><span class="sel-btn" id="selNoneHood">None</span></span>';

  hf.querySelectorAll('.ftag').forEach(t=>t.addEventListener('click',()=>{
    const k=t.dataset.hood;hoodState[k]=!hoodState[k];t.classList.toggle('off');render();
  }));
  document.getElementById('selAllHood').addEventListener('click',()=>{Object.keys(HOODS).forEach(k=>hoodState[k]=true);hf.querySelectorAll('.ftag').forEach(t=>t.classList.remove('off'));render();});
  document.getElementById('selNoneHood').addEventListener('click',()=>{Object.keys(HOODS).forEach(k=>hoodState[k]=false);hf.querySelectorAll('.ftag').forEach(t=>t.classList.add('off'));render();});
}

document.getElementById('prevMonth').addEventListener('click',()=>{if(curMonth>0){curMonth--;render();}});
document.getElementById('nextMonth').addEventListener('click',()=>{if(curMonth<MONTHS.length-1){curMonth++;render();}});

const now=new Date();
if(now.getFullYear()===2026&&now.getMonth()>=1){const mi=now.getMonth()-1;if(mi>=0&&mi<MONTHS.length)curMonth=mi;}

buildFilters();
render();
</script>
</body>
</html>