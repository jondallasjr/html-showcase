<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Change Request & Data Flow Workflow</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            text-align: center;
            padding: 30px;
        }
        .header h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 300;
        }
        .subtitle {
            margin-top: 10px;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 40px;
        }
        .process-section {
            margin-bottom: 50px;
        }
        .process-title {
            font-size: 1.6em;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid #e74c3c;
            display: flex;
            align-items: center;
        }
        .process-icon {
            background: #e74c3c;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        .workflow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .workflow-step {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            position: relative;
            transition: all 0.3s ease;
        }
        .workflow-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #007bff;
        }
        .step-number {
            position: absolute;
            top: -15px;
            left: 20px;
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        .step-description {
            color: #666;
            line-height: 1.5;
            font-size: 0.95em;
        }
        .trigger-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-top: 10px;
        }
        .manual {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .automatic {
            background: #d4edda;
            color: #155724;
            border: 1px solid #b8e6c1;
        }
        .on-demand {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }
        .dev-status {
            margin-top: 8px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .live { color: #28a745; }
        .in-dev { color: #ffc107; }
        .not-built { color: #dc3545; }
        .planned { color: #6f42c1; }
        .needs-clarification { color: #6c757d; }
        
        .sync-states {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .sync-state {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .state-title {
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        .state-definition {
            font-size: 0.85em;
            font-weight: normal;
            opacity: 0.9;
        }
        .synced { background: #28a745; }
        .unsynced { background: #ffc107; color: #212529; }
        .pending { background: #17a2b8; }
        .rejected { background: #dc3545; }
        .sync-required { background: #6f42c1; }
        
        .data-flow {
            background: #f1f3f4;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .data-flow h4 {
            color: #2c3e50;
            margin-top: 0;
        }
        .flow-item {
            margin: 10px 0;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #007bff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .info-note {
            background: #e8f4f8;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .info-note strong {
            color: #0a4249;
        }
        .summary-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .req-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .req-box {
            padding: 20px;
            border-radius: 10px;
            border: 2px solid;
        }
        .built { border-color: #28a745; background: #f8fff9; }
        .easy { border-color: #ffc107; background: #fffdf5; }
        .needs-section {
            background: #fff9f0;
            border: 2px solid #ffb347;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Task Change Request & Data Flow Workflow</h1>
            <div class="subtitle">RES Project Management System: Coda ↔ Apollo ↔ NetSuite</div>
        </div>
        
        <div class="content">
            <!-- Executive Summary -->
            <div class="process-section">
                <div class="process-title">
                    <div class="process-icon">📋</div>
                    System Overview
                </div>
                <div class="summary-box">
                    <p><strong>Data Flow Architecture:</strong> 
                    <br>• <strong>Task Change Requests:</strong> PM changes in Coda → Apollo (approval) → NetSuite (if approved)
                    <br>• <strong>Pulling Data IN:</strong> NetSuite/Apollo → Coda (manual triggers)
                    <br>• <strong>Status Updates:</strong> Apollo → Coda (change request approval/rejection status)</p>
                    
                    <p><strong>Current Implementation:</strong> David built project-level bulk Task Change Requests with Last Sync State JSON storage for comparing Coda changes against NetSuite source data.</p>
                    
                    <p><strong>Key Terminology:</strong> "Pulling" = NetSuite→Coda, "Task Change Requests" = Coda→Apollo</p>
                </div>
            </div>

            <!-- RES Core Needs -->
            <div class="process-section">
                <div class="process-title">
                    <div class="process-icon">🎯</div>
                    RES's Core Needs
                </div>
                
                <div class="needs-section">
                    <strong>Primary Requirement:</strong> PMs must clearly see when their Coda changes differ from NetSuite reality and understand the status of their change requests (pending, approved, rejected).
                    
                    <br><br><strong>Specific Requirements:</strong>
                    <br>• Visual indicator when PM makes changes but hasn't submitted requests
                    <br>• Clear differentiation between "what's live in NetSuite" vs "what PM changed in Coda"  
                    <br>• Display of rejection reasons and required corrective actions
                    <br>• Understanding that changes aren't "live" until approved
                </div>
            </div>

            <!-- Implementation Status -->
            <div class="process-section">
                <div class="process-title">
                    <div class="process-icon">📊</div>
                    Current Implementation Status
                </div>
                
                <div class="req-analysis">
                    <div class="req-box built">
                        <div class="step-title">✅ Built & Live</div>
                        <div class="step-description">
                            • Task Change Requests (project-level bulk)<br>
                            • Pull Projects (manual, entire WBS)<br>
                            • Pull Change Request status updates<br>
                            • Last Sync State JSON storage<br>
                            • Apollo approval interface
                        </div>
                        <div class="trigger-type automatic" style="margin-top: 15px;">Functional</div>
                    </div>
                    
                    <div class="req-box easy">
                        <div class="step-title">⚡ Ready to Build</div>
                        <div class="step-description">
                            • Work Item Sync States column<br>
                            • Visual indicators for unsynced changes<br>
                            • JSON parsing optimization<br>
                            • Task-level individual buttons (if needed)
                        </div>
                        <div class="trigger-type manual" style="margin-top: 15px;">UI/Formula Work</div>
                    </div>
                </div>
            </div>

            <!-- Process 1: Task Change Requests -->
            <div class="process-section">
                <div class="process-title">
                    <div class="process-icon">📤</div>
                    Task Change Requests: Coda → Apollo → NetSuite
                </div>
                
                <div class="workflow-grid">
                    <div class="workflow-step">
                        <div class="step-number">1</div>
                        <div class="step-title">PM Makes Changes</div>
                        <div class="step-description">PM updates task status, name (Level 3 only), billing type, revenue type in Coda</div>
                        <div class="trigger-type manual">Manual</div>
                        <div class="dev-status live">✅ LIVE</div>
                    </div>
                    
                    <div class="workflow-step">
                        <div class="step-number">2</div>
                        <div class="step-title">Visual Indicators</div>
                        <div class="step-description">Work Item Sync States column shows "Unsynced Changes" - PM sees changes haven't been submitted</div>
                        <div class="trigger-type automatic">Automatic</div>
                        <div class="dev-status not-built">❌ NOT BUILT</div>
                    </div>
                    
                    <div class="workflow-step">
                        <div class="step-number">3</div>
                        <div class="step-title">Submit Task Change Requests</div>
                        <div class="step-description">PM clicks "Submit Task Change Request" button (currently project-level bulk)</div>
                        <div class="trigger-type manual">Manual</div>
                        <div class="dev-status live">✅ LIVE (Project-Level)</div>
                    </div>
                    
                    <div class="workflow-step">
                        <div class="step-number">4</div>
                        <div class="step-title">Apollo Processing</div>
                        <div class="step-description">David's system sends bulk requests to Apollo for accounting review</div>
                        <div class="trigger-type automatic">Automatic</div>
                        <div class="dev-status live">✅ LIVE</div>
                    </div>
                    
                    <div class="workflow-step">
                        <div class="step-number">5</div>
                        <div class="step-title">Accounting Review</div>
                        <div class="step-description">Accounting team reviews requests in Apollo and approves/rejects</div>
                        <div class="trigger-type manual">Manual (by Accounting)</div>
                        <div class="dev-status live">✅ LIVE</div>
                    </div>
                    
                    <div class="workflow-step">
                        <div class="step-number">6</div>
                        <div class="step-title">NetSuite Update</div>
                        <div class="step-description">If approved, Apollo API automatically pushes changes to NetSuite</div>
                        <div class="trigger-type automatic">Automatic</div>
                        <div class="dev-status live">✅ LIVE</div>
                    </div>
                </div>

                <div class="data-flow">
                    <h4>Data Sent in Task Change Requests:</h4>
                    <div class="flow-item">Task Name (Level 3 only) <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">Task Status <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">Billing Type (Billable/Non-billable) <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">Revenue Type <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">PM Notes <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">NetSuite IDs (task, parent, project, PM) <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">Cost Plan Integration <span class="dev-status needs-clarification">❓ NEEDS CLARIFICATION</span></div>
                </div>
            </div>

            <!-- Process 2: Pulling Data IN -->
            <div class="process-section">
                <div class="process-title">
                    <div class="process-icon">📥</div>
                    Pulling Data IN: NetSuite/Apollo → Coda
                </div>
                
                <div class="workflow-grid">
                    <div class="workflow-step">
                        <div class="step-number">1</div>
                        <div class="step-title">Initial Project Pull</div>
                        <div class="step-description">When PM creates project, complete WBS pulled from NetSuite (manual trigger)</div>
                        <div class="trigger-type manual">Manual (Project Creation)</div>
                        <div class="dev-status live">✅ LIVE</div>
                    </div>
                    
                    <div class="workflow-step">
                        <div class="step-number">2</div>
                        <div class="step-title">Last Sync State Storage</div>
                        <div class="step-description">Each task stores complete NetSuite data in "Last Sync State" JSON as source of truth</div>
                        <div class="trigger-type automatic">Automatic</div>
                        <div class="dev-status live">✅ LIVE</div>
                    </div>
                    
                    <div class="workflow-step">
                        <div class="step-number">3</div>
                        <div class="step-title">Manual Re-Pull</div>
                        <div class="step-description">PM manually triggers re-pull of entire project WBS when needed</div>
                        <div class="trigger-type manual">Manual Only</div>
                        <div class="dev-status live">✅ LIVE</div>
                    </div>
                    
                    <div class="workflow-step">
                        <div class="step-number">4</div>
                        <div class="step-title">Change Request Status Updates</div>
                        <div class="step-description">System pulls approval/rejection status from Apollo</div>
                        <div class="trigger-type on-demand">Manual/Planned Automatic</div>
                        <div class="dev-status live">✅ LIVE</div>
                    </div>
                </div>

                <div class="data-flow">
                    <h4>Data Pulled IN from NetSuite/Apollo:</h4>
                    <div class="flow-item">Complete WBS Structure (names, hierarchy, IDs) <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">Task Status, Project Manager assignments <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">Budget data (Current/As Sold Cost & Billing Budget) <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">Hours, Revenue Type, Billable flags <span class="dev-status live">✅ LIVE</span></div>
                    <div class="flow-item">Change Request Status (Pending/Approved/Rejected) <span class="dev-status live">✅ LIVE</span></div>
                </div>
            </div>

            <!-- Work Item Sync States -->
            <div class="process-section">
                <div class="process-title">
                    <div class="process-icon">🚦</div>
                    Work Item Sync States
                </div>
                
                <div class="sync-states">
                    <div class="sync-state synced">
                        <div class="state-title">Synced</div>
                        <div class="state-definition">Coda values match Last Sync State exactly</div>
                    </div>
                    <div class="sync-state unsynced">
                        <div class="state-title">Unsynced Changes</div>
                        <div class="state-definition">PM made changes but hasn't submitted request</div>
                    </div>
                    <div class="sync-state pending">
                        <div class="state-title">Changes Pending Approval</div>
                        <div class="state-definition">Request submitted, awaiting accounting approval</div>
                    </div>
                    <div class="sync-state rejected">
                        <div class="state-title">Changes Rejected</div>
                        <div class="state-definition">Accounting rejected request, PM action required</div>
                    </div>
                    <div class="sync-state sync-required">
                        <div class="state-title">Pull Required</div>
                        <div class="state-definition">NetSuite data may have changed, manual pull needed</div>
                    </div>
                </div>
            </div>

            <!-- Clarification Questions -->
            <div class="process-section">
                <div class="process-title">
                    <div class="process-icon">❓</div>
                    Clarification Questions for RES
                </div>
                
                <div class="info-note">
                    <strong>1. Automatic Data Pulling:</strong> Should there be automatic/scheduled pulling of task data from NetSuite to Coda? Currently only manual pulling exists.
                </div>
                
                <div class="info-note">
                    <strong>2. Cost Plan Integration:</strong> Should Cost Plan data be sent with Task Change Requests, or kept as a separate Cost Budget Change Request process?
                </div>
                
                <div class="info-note">
                    <strong>3. Rejection Handling:</strong> If accounting rejects a change request, what should happen? Should Coda automatically revert to NetSuite values or require manual PM action?
                </div>
                
                <div class="info-note">
                    <strong>4. Button Placement:</strong> Should Task Change Request buttons be at the project-level (bulk) or task-level (individual) or both?
                </div>
                
                <div class="info-note">
                    <strong>5. Cost Budget Change Requests:</strong> How should the separate Cost Budget Change Request process work in relation to Task Change Requests? Are these two different workflows or integrated?
                </div>
                
                <div class="info-note">
                    <strong>6. Data Freshness:</strong> How often should PMs expect Coda to reflect the latest NetSuite data? Should this be on-demand only or include automatic updates?
                </div>
            </div>
        </div>
    </div>
</body>
</html>